{{!< default}}
{{!--
================================================================================
HOME.HBS - 12 Days of Shipmas Homepage
================================================================================

Author: Human Written (https://humanwritten.ai)
License: MIT
Repository: https://github.com/12-days-of-shipmas-2025/shipmas-ghost-theme

This is the custom homepage template featuring:
- 12 Days countdown grid (auto-hides after SHIPMAS_END_DATE)
- Welcome/intro section with subscribe box
- Regular posts feed (excluding shipmas content)

Required Ghost Admin Setup:
- Tag "12-days-of-shipmas" for day posts
- Tag "shipmas-intro" for welcome post
- See README.md for full setup instructions

================================================================================
--}}

{{!--
    SHIPMAS FEATURE TOGGLE
    The 12 Days of Shipmas sections will automatically hide after the end date.
    To change the end date, modify SHIPMAS_END_DATE in the script at the bottom of this file.
    Default: January 31, 2025
--}}

{{> "components/header" headerStyle="Off"}}

{{!-- 12 Days of Shipmas Feature Section (date-controlled) --}}
<div id="shipmas-feature">

{{!-- Intro Section - Welcome text first, subscribe below --}}
<section class="shipmas-intro gh-outer">
    <div class="gh-inner shipmas-intro-wrapper">
        {{!-- Welcome content --}}
        <div class="shipmas-intro-left">
            {{#get "posts" filter="tag:shipmas-intro" limit="1" include="authors"}}
                {{#foreach posts}}
                    <article class="shipmas-intro-card">
                        <h1 class="shipmas-intro-title">
                            <a href="{{url}}">{{title}}</a>
                        </h1>
                        {{#if custom_excerpt}}
                            <p class="shipmas-intro-excerpt">{{custom_excerpt}}</p>
                        {{else}}
                            <p class="shipmas-intro-excerpt">{{excerpt words="40"}}</p>
                        {{/if}}
                        <a href="{{url}}" class="shipmas-read-link">Read the full intro &rarr;</a>
                    </article>
                {{/foreach}}
            {{/get}}
        </div>

        {{!-- Subscribe box --}}
        <div class="shipmas-intro-right">
            <div class="shipmas-subscribe-box">
                <h3 class="shipmas-subscribe-title">Stay Updated</h3>
                <p class="shipmas-subscribe-text">Get notified when we ship each day</p>
                {{> "email-subscription" email_field_id="shipmas-subscribe"}}
            </div>
        </div>
    </div>
</section>

{{!-- 12 Days of Shipmas Grid --}}
<section class="shipmas-grid-section gh-outer">
    <div class="gh-inner">

        <div class="shipmas-grid">
            {{!-- Fetch each day explicitly by its day-X tag for reliable ordering --}}
            {{#get "posts" filter="tag:day-1" limit="1" include="tags"}}
                {{#foreach posts}}
                    <a href="{{url}}" class="shipmas-card revealed" data-day="1">
                        <div class="shipmas-card-inner">
                            <span class="shipmas-day-number">Day 1</span>
                            {{#if feature_image}}<div class="shipmas-card-image" style="background-image: url('{{feature_image}}')"></div>{{else}}<div class="shipmas-card-image shipmas-card-placeholder"></div>{{/if}}
                            <div class="shipmas-card-content">
                                <h3 class="shipmas-card-title">{{title}}</h3>
                                <p class="shipmas-card-excerpt">{{#if custom_excerpt}}{{custom_excerpt}}{{else}}{{excerpt words="8"}}{{/if}}</p>
                            </div>
                        </div>
                    </a>
                {{/foreach}}
            {{/get}}
            {{#get "posts" filter="tag:day-2" limit="1" include="tags"}}
                {{#foreach posts}}
                    <a href="{{url}}" class="shipmas-card revealed" data-day="2">
                        <div class="shipmas-card-inner">
                            <span class="shipmas-day-number">Day 2</span>
                            {{#if feature_image}}<div class="shipmas-card-image" style="background-image: url('{{feature_image}}')"></div>{{else}}<div class="shipmas-card-image shipmas-card-placeholder"></div>{{/if}}
                            <div class="shipmas-card-content">
                                <h3 class="shipmas-card-title">{{title}}</h3>
                                <p class="shipmas-card-excerpt">{{#if custom_excerpt}}{{custom_excerpt}}{{else}}{{excerpt words="8"}}{{/if}}</p>
                            </div>
                        </div>
                    </a>
                {{/foreach}}
            {{/get}}
            {{#get "posts" filter="tag:day-3" limit="1" include="tags"}}
                {{#foreach posts}}
                    <a href="{{url}}" class="shipmas-card revealed" data-day="3">
                        <div class="shipmas-card-inner">
                            <span class="shipmas-day-number">Day 3</span>
                            {{#if feature_image}}<div class="shipmas-card-image" style="background-image: url('{{feature_image}}')"></div>{{else}}<div class="shipmas-card-image shipmas-card-placeholder"></div>{{/if}}
                            <div class="shipmas-card-content">
                                <h3 class="shipmas-card-title">{{title}}</h3>
                                <p class="shipmas-card-excerpt">{{#if custom_excerpt}}{{custom_excerpt}}{{else}}{{excerpt words="8"}}{{/if}}</p>
                            </div>
                        </div>
                    </a>
                {{/foreach}}
            {{/get}}
            {{#get "posts" filter="tag:day-4" limit="1" include="tags"}}
                {{#foreach posts}}
                    <a href="{{url}}" class="shipmas-card revealed" data-day="4">
                        <div class="shipmas-card-inner">
                            <span class="shipmas-day-number">Day 4</span>
                            {{#if feature_image}}<div class="shipmas-card-image" style="background-image: url('{{feature_image}}')"></div>{{else}}<div class="shipmas-card-image shipmas-card-placeholder"></div>{{/if}}
                            <div class="shipmas-card-content">
                                <h3 class="shipmas-card-title">{{title}}</h3>
                                <p class="shipmas-card-excerpt">{{#if custom_excerpt}}{{custom_excerpt}}{{else}}{{excerpt words="8"}}{{/if}}</p>
                            </div>
                        </div>
                    </a>
                {{/foreach}}
            {{/get}}
            {{#get "posts" filter="tag:day-5" limit="1" include="tags"}}
                {{#foreach posts}}
                    <a href="{{url}}" class="shipmas-card revealed" data-day="5">
                        <div class="shipmas-card-inner">
                            <span class="shipmas-day-number">Day 5</span>
                            {{#if feature_image}}<div class="shipmas-card-image" style="background-image: url('{{feature_image}}')"></div>{{else}}<div class="shipmas-card-image shipmas-card-placeholder"></div>{{/if}}
                            <div class="shipmas-card-content">
                                <h3 class="shipmas-card-title">{{title}}</h3>
                                <p class="shipmas-card-excerpt">{{#if custom_excerpt}}{{custom_excerpt}}{{else}}{{excerpt words="8"}}{{/if}}</p>
                            </div>
                        </div>
                    </a>
                {{/foreach}}
            {{/get}}
            {{#get "posts" filter="tag:day-6" limit="1" include="tags"}}
                {{#foreach posts}}
                    <a href="{{url}}" class="shipmas-card revealed" data-day="6">
                        <div class="shipmas-card-inner">
                            <span class="shipmas-day-number">Day 6</span>
                            {{#if feature_image}}<div class="shipmas-card-image" style="background-image: url('{{feature_image}}')"></div>{{else}}<div class="shipmas-card-image shipmas-card-placeholder"></div>{{/if}}
                            <div class="shipmas-card-content">
                                <h3 class="shipmas-card-title">{{title}}</h3>
                                <p class="shipmas-card-excerpt">{{#if custom_excerpt}}{{custom_excerpt}}{{else}}{{excerpt words="8"}}{{/if}}</p>
                            </div>
                        </div>
                    </a>
                {{/foreach}}
            {{/get}}
            {{#get "posts" filter="tag:day-7" limit="1" include="tags"}}
                {{#foreach posts}}
                    <a href="{{url}}" class="shipmas-card revealed" data-day="7">
                        <div class="shipmas-card-inner">
                            <span class="shipmas-day-number">Day 7</span>
                            {{#if feature_image}}<div class="shipmas-card-image" style="background-image: url('{{feature_image}}')"></div>{{else}}<div class="shipmas-card-image shipmas-card-placeholder"></div>{{/if}}
                            <div class="shipmas-card-content">
                                <h3 class="shipmas-card-title">{{title}}</h3>
                                <p class="shipmas-card-excerpt">{{#if custom_excerpt}}{{custom_excerpt}}{{else}}{{excerpt words="8"}}{{/if}}</p>
                            </div>
                        </div>
                    </a>
                {{/foreach}}
            {{/get}}
            {{#get "posts" filter="tag:day-8" limit="1" include="tags"}}
                {{#foreach posts}}
                    <a href="{{url}}" class="shipmas-card revealed" data-day="8">
                        <div class="shipmas-card-inner">
                            <span class="shipmas-day-number">Day 8</span>
                            {{#if feature_image}}<div class="shipmas-card-image" style="background-image: url('{{feature_image}}')"></div>{{else}}<div class="shipmas-card-image shipmas-card-placeholder"></div>{{/if}}
                            <div class="shipmas-card-content">
                                <h3 class="shipmas-card-title">{{title}}</h3>
                                <p class="shipmas-card-excerpt">{{#if custom_excerpt}}{{custom_excerpt}}{{else}}{{excerpt words="8"}}{{/if}}</p>
                            </div>
                        </div>
                    </a>
                {{/foreach}}
            {{/get}}
            {{#get "posts" filter="tag:day-9" limit="1" include="tags"}}
                {{#foreach posts}}
                    <a href="{{url}}" class="shipmas-card revealed" data-day="9">
                        <div class="shipmas-card-inner">
                            <span class="shipmas-day-number">Day 9</span>
                            {{#if feature_image}}<div class="shipmas-card-image" style="background-image: url('{{feature_image}}')"></div>{{else}}<div class="shipmas-card-image shipmas-card-placeholder"></div>{{/if}}
                            <div class="shipmas-card-content">
                                <h3 class="shipmas-card-title">{{title}}</h3>
                                <p class="shipmas-card-excerpt">{{#if custom_excerpt}}{{custom_excerpt}}{{else}}{{excerpt words="8"}}{{/if}}</p>
                            </div>
                        </div>
                    </a>
                {{/foreach}}
            {{/get}}
            {{#get "posts" filter="tag:day-10" limit="1" include="tags"}}
                {{#foreach posts}}
                    <a href="{{url}}" class="shipmas-card revealed" data-day="10">
                        <div class="shipmas-card-inner">
                            <span class="shipmas-day-number">Day 10</span>
                            {{#if feature_image}}<div class="shipmas-card-image" style="background-image: url('{{feature_image}}')"></div>{{else}}<div class="shipmas-card-image shipmas-card-placeholder"></div>{{/if}}
                            <div class="shipmas-card-content">
                                <h3 class="shipmas-card-title">{{title}}</h3>
                                <p class="shipmas-card-excerpt">{{#if custom_excerpt}}{{custom_excerpt}}{{else}}{{excerpt words="8"}}{{/if}}</p>
                            </div>
                        </div>
                    </a>
                {{/foreach}}
            {{/get}}
            {{#get "posts" filter="tag:day-11" limit="1" include="tags"}}
                {{#foreach posts}}
                    <a href="{{url}}" class="shipmas-card revealed" data-day="11">
                        <div class="shipmas-card-inner">
                            <span class="shipmas-day-number">Day 11</span>
                            {{#if feature_image}}<div class="shipmas-card-image" style="background-image: url('{{feature_image}}')"></div>{{else}}<div class="shipmas-card-image shipmas-card-placeholder"></div>{{/if}}
                            <div class="shipmas-card-content">
                                <h3 class="shipmas-card-title">{{title}}</h3>
                                <p class="shipmas-card-excerpt">{{#if custom_excerpt}}{{custom_excerpt}}{{else}}{{excerpt words="8"}}{{/if}}</p>
                            </div>
                        </div>
                    </a>
                {{/foreach}}
            {{/get}}
            {{#get "posts" filter="tag:day-12" limit="1" include="tags"}}
                {{#foreach posts}}
                    <a href="{{url}}" class="shipmas-card revealed" data-day="12">
                        <div class="shipmas-card-inner">
                            <span class="shipmas-day-number">Day 12</span>
                            {{#if feature_image}}<div class="shipmas-card-image" style="background-image: url('{{feature_image}}')"></div>{{else}}<div class="shipmas-card-image shipmas-card-placeholder"></div>{{/if}}
                            <div class="shipmas-card-content">
                                <h3 class="shipmas-card-title">{{title}}</h3>
                                <p class="shipmas-card-excerpt">{{#if custom_excerpt}}{{custom_excerpt}}{{else}}{{excerpt words="8"}}{{/if}}</p>
                            </div>
                        </div>
                    </a>
                {{/foreach}}
            {{/get}}
        </div>
    </div>
</section>

</div>{{!-- End #shipmas-feature --}}

{{!-- Regular Posts Feed (excluding shipmas posts) --}}
<section class="gh-container is-list gh-outer other-posts-section">
    <div class="gh-container-inner gh-inner">
        <div class="gh-container-header">
            <h2 class="gh-container-title">Posts</h2>
            <a href="{{@site.url}}/blog/" class="gh-see-all-link">See All &rarr;</a>
        </div>
        <main class="gh-main">
            <div class="gh-feed">
                {{#get "posts" filter="tag:-12-days-of-shipmas+tag:-shipmas-intro" include="authors" limit="6"}}
                    {{#foreach posts}}
                        {{> "post-card" lazyLoad=true}}
                    {{/foreach}}
                {{/get}}
            </div>
        </main>
    </div>
</section>

{{!-- JavaScript for 12 Days of Shipmas --}}
<script>
(function() {
    // ============================================
    // SHIPMAS FEATURE TOGGLE - DATE CONFIGURATION
    // ============================================
    // Auto-calculate shipmas year: Dec = next year's Jan 31, otherwise current year's Jan 31
    const now = new Date();
    const shipmasYear = now.getMonth() >= 11 ? now.getFullYear() + 1 : now.getFullYear();
    const SHIPMAS_END_DATE = new Date(shipmasYear, 0, 31, 23, 59, 59);
    const shipmasFeature = document.getElementById('shipmas-feature');

    // Hide the 12 Days section if we're past the end date
    if (now > SHIPMAS_END_DATE && shipmasFeature) {
        shipmasFeature.style.display = 'none';
        return; // No need to run the rest of the script
    }

    // ============================================
    // LOCKED DAYS GRID LOGIC
    // ============================================
    const grid = document.querySelector('.shipmas-grid');
    if (!grid) return;

    const existingCards = grid.querySelectorAll('.shipmas-card');
    const existingDays = new Set();
    existingCards.forEach(card => {
        const day = parseInt(card.dataset.day);
        if (day) existingDays.add(day);
    });

    // Create locked cards for missing days
    const allCards = [];

    for (let day = 1; day <= 12; day++) {
        if (!existingDays.has(day)) {
            const card = document.createElement('div');
            card.className = 'shipmas-card locked';
            card.dataset.day = day;
            card.innerHTML = `
                <div class="shipmas-card-inner">
                    <span class="shipmas-day-number">Day ${day}</span>
                    <div class="shipmas-card-image shipmas-card-locked">
                        <svg class="shipmas-lock-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                        </svg>
                    </div>
                    <div class="shipmas-card-content">
                        <h3 class="shipmas-card-title">Coming Soon</h3>
                        <p class="shipmas-card-excerpt">Check back on day ${day}</p>
                    </div>
                </div>
            `;
            allCards.push({ day, card, existing: false });
        }
    }

    // Collect existing cards with their days
    existingCards.forEach(card => {
        const day = parseInt(card.dataset.day);
        allCards.push({ day, card, existing: true });
    });

    // Sort by day number
    allCards.sort((a, b) => a.day - b.day);

    // Clear and re-add in order
    grid.innerHTML = '';
    allCards.forEach(({ card }) => grid.appendChild(card));
})();
</script>

